{% extends "base.html" %}

{% block title %}All Diagrams - Architecture Diagrams{% endblock %}

{% block extra_head %}
<style>
    .page-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 1rem;
    }

    .page-description {
        font-size: 1.1rem;
        color: #64748b;
        max-width: 600px;
        margin: 0 auto;
    }

    .filters {
        background: #fff;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    .filter-row {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .filter-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .filter-group label {
        font-weight: 500;
        color: #374151;
    }

    .filter-select {
        padding: 0.5rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: #fff;
        font-size: 0.9rem;
    }

    .search-box {
        flex: 1;
        min-width: 250px;
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 1rem;
    }

    .diagram-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 2rem;
        margin: 2rem 0;
    }

    .diagram-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .diagram-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .diagram-card-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        background: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #64748b;
    }

    .diagram-card-content {
        padding: 1.5rem;
    }

    .diagram-card h3 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #1e293b;
    }

    .diagram-card p {
        color: #64748b;
        margin-bottom: 1rem;
        line-height: 1.6;
    }

    .diagram-card-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9rem;
        color: #64748b;
        margin-bottom: 1rem;
    }

    .diagram-type-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: #e0e7ff;
        color: #3730a3;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        text-transform: capitalize;
    }

    .diagram-type-badge.system-context {
        background: #fef3c7;
        color: #92400e;
    }

    .diagram-type-badge.container {
        background: #d1fae5;
        color: #065f46;
    }

    .diagram-type-badge.component {
        background: #e0e7ff;
        color: #3730a3;
    }

    .diagram-card-actions {
        display: flex;
        gap: 0.5rem;
    }

    .btn-small {
        padding: 0.4rem 0.8rem;
        font-size: 0.9rem;
        border-radius: 4px;
        text-decoration: none;
        font-weight: 500;
        transition: background-color 0.2s;
    }

    .btn-primary {
        background: #2563eb;
        color: white;
    }

    .btn-primary:hover {
        background: #1d4ed8;
    }

    .btn-secondary {
        background: #f1f5f9;
        color: #64748b;
        border: 1px solid #e2e8f0;
    }

    .btn-secondary:hover {
        background: #e2e8f0;
    }

    .no-results {
        text-align: center;
        padding: 3rem;
        color: #64748b;
    }

    .no-results h3 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: #374151;
    }

    .results-count {
        margin-bottom: 1rem;
        color: #64748b;
        font-size: 0.9rem;
    }

    @media (max-width: 768px) {
        .filter-row {
            flex-direction: column;
            align-items: stretch;
        }

        .filter-group {
            justify-content: space-between;
        }

        .search-box {
            min-width: auto;
        }

        .diagram-grid {
            grid-template-columns: 1fr;
        }

        .diagram-card-actions {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb">
    <a href="/">Home</a> / All Diagrams
</div>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">All Diagrams</h1>
    <p class="page-description">Browse and explore all available architecture diagrams</p>
</div>

<div class="filters">
    <div class="filter-row">
        <input type="text" class="search-box" placeholder="Search diagrams..." id="searchBox">
        <div class="filter-group">
            <label for="typeFilter">Type:</label>
            <select class="filter-select" id="typeFilter">
                <option value="">All Types</option>
                <option value="system_context">System Context</option>
                <option value="container">Container</option>
                <option value="component">Component</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="sortFilter">Sort by:</label>
            <select class="filter-select" id="sortFilter">
                <option value="name">Name</option>
                <option value="date">Last Updated</option>
                <option value="type">Type</option>
            </select>
        </div>
    </div>
</div>

<div class="results-count" id="resultsCount">
    Showing {{ diagrams|length }} diagram{{ 's' if diagrams|length != 1 else '' }}
</div>

{% if diagrams %}
<div class="diagram-grid" id="diagramGrid">
    {% for diagram in diagrams %}
    <div class="diagram-card" data-name="{{ diagram.title|lower }}" data-type="{{ diagram.diagram_type }}" data-date="{{ diagram.last_updated.isoformat() }}">
        <a href="/diagrams/{{ diagram.file_path | replace('.py', '.html') }}">
            {% if diagram.output_files.get('png') %}
            <img src="{{ diagram.output_files.png }}" alt="{{ diagram.title }}" class="diagram-card-image">
            {% else %}
            <div class="diagram-card-image">
                <span>No preview available</span>
            </div>
            {% endif %}
        </a>
        <div class="diagram-card-content">
            <h3>{{ diagram.title }}</h3>
            <p>{{ diagram.description[:150] }}{% if diagram.description|length > 150 %}...{% endif %}</p>
            <div class="diagram-card-meta">
                <span class="diagram-type-badge {{ diagram.diagram_type }}">{{ diagram.diagram_type.replace('_', ' ') }}</span>
                <span>{{ diagram.last_updated.strftime('%b %d, %Y') }}</span>
            </div>
            <div class="diagram-card-actions">
                <a href="/diagrams/{{ diagram.file_path | replace('.py', '.html') }}" class="btn-small btn-primary">View Details</a>
                {% if diagram.output_files.get('png') %}
                <a href="{{ diagram.output_files.png }}" class="btn-small btn-secondary" target="_blank">PNG</a>
                {% endif %}
                {% if diagram.output_files.get('svg') %}
                <a href="{{ diagram.output_files.svg }}" class="btn-small btn-secondary" target="_blank">SVG</a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="no-results">
    <h3>No Diagrams Found</h3>
    <p>There are no diagrams available at the moment. Check back later or create some diagrams to get started.</p>
</div>
{% endif %}

<div class="no-results" id="noResults" style="display: none;">
    <h3>No Matching Diagrams</h3>
    <p>No diagrams match your current search criteria. Try adjusting your filters or search terms.</p>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchBox = document.getElementById('searchBox');
    const typeFilter = document.getElementById('typeFilter');
    const sortFilter = document.getElementById('sortFilter');
    const diagramGrid = document.getElementById('diagramGrid');
    const resultsCount = document.getElementById('resultsCount');
    const noResults = document.getElementById('noResults');
    const diagramCards = Array.from(document.querySelectorAll('.diagram-card'));

    function filterAndSort() {
        const searchTerm = searchBox.value.toLowerCase();
        const typeFilter_value = typeFilter.value;
        const sortBy = sortFilter.value;

        // Filter cards
        let visibleCards = diagramCards.filter(card => {
            const name = card.dataset.name;
            const type = card.dataset.type;
            
            const matchesSearch = !searchTerm || name.includes(searchTerm);
            const matchesType = !typeFilter_value || type === typeFilter_value;
            
            return matchesSearch && matchesType;
        });

        // Sort cards
        visibleCards.sort((a, b) => {
            switch (sortBy) {
                case 'name':
                    return a.dataset.name.localeCompare(b.dataset.name);
                case 'date':
                    return new Date(b.dataset.date) - new Date(a.dataset.date);
                case 'type':
                    return a.dataset.type.localeCompare(b.dataset.type);
                default:
                    return 0;
            }
        });

        // Hide all cards
        diagramCards.forEach(card => card.style.display = 'none');

        // Show filtered and sorted cards
        visibleCards.forEach(card => card.style.display = 'block');

        // Update results count
        const count = visibleCards.length;
        resultsCount.textContent = `Showing ${count} diagram${count !== 1 ? 's' : ''}`;

        // Show/hide no results message
        if (count === 0) {
            diagramGrid.style.display = 'none';
            noResults.style.display = 'block';
        } else {
            diagramGrid.style.display = 'grid';
            noResults.style.display = 'none';
        }
    }

    // Add event listeners
    searchBox.addEventListener('input', filterAndSort);
    typeFilter.addEventListener('change', filterAndSort);
    sortFilter.addEventListener('change', filterAndSort);
});
</script>
{% endblock %}